var Breakdown,breakdown;(function(n){const i=[1,2,3,4,5,6,7,8];class u{constructor(n,t,i,r,u){this.id=n;this.title=t;this.rhythm=i;this.start=r;this.bars=u;this.measures=Math.ceil(this.bars/2)}measureMarkers(){return i.slice(0,this.measures)}beatsInMeasure(n){return this.bars%2==1&&n===this.measures?4:8}beatMarkers(n){return i.slice(0,this.beatsInMeasure(n))}}class f{constructor(){this._count=0}get count(){return this._count}get end(){return this._count===0?1:this[this._count-1].start+this[this._count-1].bars*4}add(n,t,i){return this[this._count]=new u(this._count,n,t,this.end,i),this._count++,this}previousBeatIndex(n){if(n.id!==0)return this[n.id-1].start}nextBeatIndex(n){if(n.id!==this._count-1)return this[n.id+1].start}sectionAtBeatIndex(n){for(var t=this._count-1;t>0;t--)if(this[t].start<=n)break;return this[t]}}class t{constructor(n,t=0,i=-15,r=0){this.name=n;this.startTime=t;this.normalVolume=i;this.loudVolume=r;this.level="normal";this.player=new Tone.Player("audio/"+n+".mp3").sync().start(t).toMaster();this.player.volume.value=i}mute(){this.player.mute=!0;this.level="mute"}normal(){this.player.mute=!1;this.player.volume.value=this.normalVolume;this.level="normal"}loud(){this.player.mute=!1;this.player.volume.value=this.loudVolume;this.level="loud"}buttonClass(n){let t={};return this.level===n?t["btn-info"]=!0:t["btn-outline-info"]=!0,t}}class r{constructor(n){this.$scope=n;this.ready=!1;this.beatIndex=0;this.sections=new f;this.instruments=[];this.playing=!1;Tone.Transport.timeSignature=4;Tone.Transport.bpm.value=124;this.sections.add("Start","Count-In",1).add("Intro","Majao",8).add("Verse 1","Derecho",8).add("Chorus","Majao",8).add("Bridge","Derecho",8).add("Verse 2","Derecho",8).add("Chorus","Majao",8).add("Bridge","Urban/Majao",4).add("Chorus","Majao",8).add("Mambo","Majao",8).add("Breakdown","Urban",9).add("Chorus","Majao",8).add("Bridge","Urban/Majao",4).add("Chorus","Majao",8).add("End","End",2);this.instruments.push(new t("bongo"));this.instruments.push(new t("guira"));this.instruments.push(new t("bass"));this.instruments.push(new t("segunda",2.1));this.instruments.push(new t("requinto",1.4,-15,-5));Tone.Buffer.on("load",()=>{this.ready=!0,n.$apply(),Tone.Transport.scheduleRepeat(()=>{let t=Tone.Transport.position.split(":");this.beatIndex=parseInt(t[0])*4+parseInt(t[1]);this.beatIndex>=this.sections.end&&Tone.Transport.state==="started"&&(Tone.Transport.stop(),this.playing=!1,this.gotoBeatIndex(0));n.$apply()},"4n","0:1")})}get section(){return this.sections.sectionAtBeatIndex(this.beatIndex)}get measure(){return Math.floor((this.beatIndex-this.section.start)/8)+1||1}get beat(){return(this.beatIndex-this.section.start)%this.section.beatsInMeasure(this.measure)+1||1}toggle(){Tone.Transport.state==="started"?(Tone.Transport.pause(),this.playing=!1):(Tone.Transport.start(),this.playing=!0)}gotoBeatIndex(n){let t=n===0?"0:0:0":Math.floor(n/4)+":1:0";Tone.Transport.position=t;this.beatIndex=n}back(){this.gotoBeatIndex(this.measure>1?this.section.start:this.sections.previousBeatIndex(this.section)||0)}next(){this.gotoBeatIndex(this.sections.nextBeatIndex(this.section)||0)}$postLink(){}}r.$inject=["$scope"];n.MainCtrl=r})(Breakdown||(Breakdown={}));breakdown=angular.module("breakdown",[]);breakdown.controller("mainCtrl",Breakdown.MainCtrl);