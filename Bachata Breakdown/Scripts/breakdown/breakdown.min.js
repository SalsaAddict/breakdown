var BB,Breakdown,breakdown;(function(n){const i=[1,2,3,4,5,6,7,8];class u{constructor(n,t,i,r){this.title=n;this.rhythm=t;this.start=i;this.bars=r;this.measures=Math.ceil(this.bars/2)}measureMarkers(){return i.slice(0,this.measures)}beatsInMeasure(n){return this.bars%2==1&&n===this.measures?4:8}beatMarkers(n){return i.slice(0,this.beatsInMeasure(n))}}class f{constructor(){this._count=0}get count(){return this._count}add(n,t,i){let r=this._count===0?1:this[this._count-1].bars*4+this[this._count-1].start;return this[this._count]=new u(n,t,r,i),this._count++,this}sectionAtBeatIndex(n){for(var t=this._count-1;t>0;t--)if(this[t].start<=n)break;return this[t]}}class t{constructor(n,t=0,i=-15,r=0){this.name=n;this.startTime=t;this.normalVolume=i;this.loudVolume=r;this.level="normal";this.player=new Tone.Player("audio/"+n+".mp3").sync().start(t).toMaster();this.player.volume.value=i}}class r{constructor(n){this.$scope=n;this.ready=!1;this.beatIndex=0;this.sections=new f;this.instruments=[];this.playing=!1;Tone.Transport.timeSignature=4;Tone.Transport.bpm.value=124;this.sections.add("Count-In","Count-In",1).add("Intro","Majao",8).add("Verse 1","Derecho",8).add("Chorus","Majao",8).add("Bridge","Derecho",8).add("Verse 2","Derecho",8).add("Chorus","Majao",8).add("Bridge","Urban/Majao",4).add("Mambo","Majao",8).add("Breakdown","Urban",9).add("Chorus","Majao",8);this.instruments.push(new t("bongo"));this.instruments.push(new t("guira"));this.instruments.push(new t("bass"));this.instruments.push(new t("segunda",2.1));this.instruments.push(new t("requinto",1.4,-15,-5));Tone.Buffer.on("load",()=>{this.ready=!0,n.$apply(),Tone.Transport.scheduleRepeat(()=>{let t=Tone.Transport.position.split(":");this.beatIndex=parseInt(t[0])*4+parseInt(t[1]);n.$apply()},"4n","0:1")})}get measure(){if(this.section)return Math.floor((this.beatIndex-this.section.start)/8)+1}get beat(){if(this.section)return(this.beatIndex-this.section.start)%this.section.beatsInMeasure(this.measure)+1}get section(){if(this.beatIndex)return this.sections.sectionAtBeatIndex(this.beatIndex)}toggle(){Tone.Transport.state==="started"?(Tone.Transport.pause(),this.playing=!1):(Tone.Transport.start(),this.playing=!0)}$postLink(){}}r.$inject=["$scope"];n.MainCtrl=r})(BB||(BB={})),function(n){class t{constructor(n){this.blocks=[1,2,3,4,5,6,7,8];this.ready=!1;this.instruments=[{name:"bongo"},{name:"guira"},{name:"bass"},{name:"segunda",start:2.1},{name:"requinto",start:1.4,quiet:-15,normal:-5}];this.phrases=[{start:1,length:32,title:"Intro",rhythm:"Majao"},{start:33,length:32,title:"Verse 1",rhythm:"Derecho"},{start:65,length:32,title:"Chorus",rhythm:"Majao"},{start:97,length:32,title:"Bridge",rhythm:"Derecho"},{start:129,length:32,title:"Verse 2",rhythm:"Derecho"},{start:161,length:32,title:"Chorus",rhythm:"Majao"},];Tone.Transport.timeSignature=4;Tone.Transport.bpm.value=124;angular.forEach(this.instruments,n=>{this[n.name]=new Tone.Player("audio/"+n.name+".mp3").sync().start(n.start||0).toMaster(),this[n.name].volume.value=n.normal||0,n.level="normal"});Tone.Buffer.on("load",()=>{this.ready=!0,n.$apply(),Tone.Transport.scheduleRepeat(()=>{let t=Tone.Transport.position.split(":");this.counter=(parseInt(t[0])-1)*4+parseInt(t[1]);this.phrase=this.counter<1?null:this.counter<=32?this.phrases[0]:this.counter<=64?this.phrases[1]:this.counter<=96?this.phrases[2]:this.counter<=128?this.phrases[3]:this.counter<=160?this.phrases[4]:this.counter<=192?this.phrases[5]:null;n.$apply()},"4n","0:1")})}get beat(){return(this.counter-1)%4+1}get step(){return(this.counter-1)%8+1}get measures(){if(this.phrase)return this.phrase.length/8}get measure(){if(this.phrase)return Math.floor((this.counter-1)/8)%this.measures+1}level(n,t){n.level=t;switch(n.level){case"mute":this[n.name].mute=!0;break;case"quiet":this[n.name].mute=!1;this[n.name].volume.value=n.quiet||-15;break;case"normal":this[n.name].mute=!1;this[n.name].volume.value=n.normal||0}}rewind(){let n=Tone.Transport.state==="started";Tone.Transport.stop();n&&Tone.Transport.start(0)}toggle(){Tone.Transport.state==="started"?Tone.Transport.pause():Tone.Transport.start()}$postLink(){}}t.$inject=["$scope"];n.MainCtrl=t}(Breakdown||(Breakdown={}));breakdown=angular.module("breakdown",[]);breakdown.controller("mainCtrl",BB.MainCtrl);